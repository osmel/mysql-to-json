'use strict';

const _ = require('lodash');
const fs = require('fs');
const http = require('http');
const runAsyncGen = require('../index.js');

const server = http.createServer();

server.on('request', function(req, res) {
	runAsyncGen(onRequestGen(req, res), function(err) {
		if (err) {
			console.error(err);
		}
	});
});

const onRequestGen = function*(req, res) {
	const text = yield _.bind(fs.readFile, fs, 'test.txt');
	res.end(text);
};

server.listen(1488);
